{
  "id": "8292684d-e13f-493b-818e-3ec9cf1be482",
  "name": "dennismicheelsen-promotepackages-task",
  "friendlyName": "Promote packages to Release View",
  "description": "Promotes packages to a Release View in VSTS/TFS Package Management",
  "helpMarkDown": "Promotes either a package folder, or ",
  "category": "Package",
  "author": "Dennis Micheelsen",
  "version": {
    "Major": 0,
    "Minor": 4,
    "Patch": 15
  },
  "visibility": [
    "Build",
    "Release"
  ],
  "minimumAgentVersion": "1.83.0",
  "groups": [
    {
      "name": "general",
      "displayName": "General Settings",
      "isExpanded": true
    }
  ],
  "inputs": [
    {
      "name": "feed",
      "groupName": "general",
      "type": "pickList",
      "label": "Use this TFS feed",
      "defaultValue": "",
      "helpMarkDown": "Push to this feed, and if any symbols packages is generated, pushes those to a <FEEDNAME>-symbols feed",
      "required": "true",
      "properties": {
        "EditableOptions": "true"
      }
    },
    {
      "name": "packageorfolder",
      "groupname": "general",
      "type": "radio",
      "defaultValue": "folder",
      "options": {
        "folder": "folder of packages",
        "package": "Specific package"
      }
    },
    {
      "name": "pattern",
      "groupName": "general",
      "type": "filePath",
      "label": "Pattern for locating packages",
      "defaultValue": "$(Build.StagingDirectory)\\packages",
      "helpMarkDown": "",
      "required": "true",
      "properties": {
        "EditableOptions": "true"
      },
      "visibleRule": "packageorfolder = folder"
    },
    {
      "name": "definition",
      "groupName": "general",
      "type": "pickList",
      "label": "Package",
      "defaultValue": "",
      "helpMarkDown": "Select the package that you want to promote",
      "required": "false",
      "properties": {
        "EditableOptions": "true"
      },
      "visibleRule": "packageorfolder = package"
    },
    {
      "name": "version",
      "groupName": "general",
      "type": "pickList",
      "label": "Package Version",
      "defaultValue": "",
      "helpMarkDown": "Select the version of the package that you want to promote",
      "required": "false",
      "properties": {
        "EditableOptions": "true"
      },
      "visibleRule": "packageorfolder = package"
    },
    {
      "name": "releaseView",
      "groupName": "general",
      "type": "pickList",
      "label": "Release Views",
      "defaultValue": "",
      "helpMarkDown": "Select the view to promote the package(s) to",
      "required": "true",
      "properties": {
        "EditableOptions": "false"
      }
    }
  ],
  "dataSourceBindings": [
    {
      "target": "feed",
      "endpointId": "tfs:feed",
      "endpointUrl": "{{endpoint.url}}/_apis/packaging/feeds",
      "resultSelector": "jsonpath:$.value[*]",
      "resultTemplate": "{ \"Value\" : \"{{{name}}}\", \"DisplayValue\" : \"{{{name}}}\" }"
    },
    {
      "target": "symbolfeed",
      "endpointId": "tfs:feed",
      "endpointUrl": "{{endpoint.url}}/_apis/packaging/feeds",
      "resultSelector": "jsonpath:$.value[*]",
      "resultTemplate": "{ \"Value\" : \"{{{name}}}\", \"DisplayValue\" : \"{{{name}}}\" }"
    },
    {
      "target": "definition",
      "endpointId": "tfs:feed",
      "parameters": {
        "feed": "$(feed)"
      },
      "endpointUrl": "{{endpoint.url}}/_apis/Packaging/Feeds/{{{feed}}}/Packages?includeUrls=false",
      "resultSelector": "jsonpath:$.value[*]",
      "resultTemplate": "{ \"Value\" : \"{{{id}}}\", \"DisplayValue\" : \"{{{name}}}\" }"
    },
    {
      "target": "version",
      "endpointId": "tfs:feed",
      "parameters": {
        "feed": "$(feed)",
        "definition": "$(definition)"
      },
      "endpointUrl": "{{endpoint.url}}/_apis/Packaging/Feeds/{{{feed}}}/Packages/{{{definition}}}/Versions?includeUrls=false",
      "resultSelector": "jsonpath:$.value[*]",
      "resultTemplate": "{ \"Value\" : \"{{{version}}}\", \"DisplayValue\" : \"{{{version}}}\" }"
    },
    {
      "target": "releaseView",
      "endpointId": "tfs:feed",
      "parameters": {
        "feed": "$(feed)"
      },
      "endpointUrl": "{{endpoint.url}}/_apis/Packaging/Feeds/{{{feed}}}/views",
      "resultSelector": "jsonpath:$.value[*]",
      "resultTemplate": "{ \"Value\" : \"{{{name}}}\", \"DisplayValue\" : \"{{{name}}}\" }"
    }
  ],
  "instanceNameFormat": "Promote packages to Release View",
  "execution": {
    "PowerShell3": {
      "target": "$(currentDirectory)\\vsts-promotepackage-task.ps1",
      "argumentFormat": ""
    }
  }
}